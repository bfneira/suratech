# SQL Task -- Retrieve Last Quote per `document_id` (MySQL)

## Overview

This document provides the SQL solution to obtain the **latest quote per
`document_id`** for a list of 500 IDs in MySQL 8+, including indexing
guidance.

The solution uses:

-   A temporary table to handle 500 IDs efficiently
-   A window function (`ROW_NUMBER()`)
-   A composite index to optimize filtering and ordering

------------------------------------------------------------------------

## Recommended Index (Run Once)

``` sql
CREATE INDEX ix_quotes_doc_created_id
ON quotes (document_id, created_at, id);
```

### Why this index?

-   Supports filtering by `document_id`
-   Supports ordering by `created_at DESC, id DESC`
-   Enables efficient reverse index scans in MySQL 8+
-   Avoids full table scans when dataset is large

------------------------------------------------------------------------

## Complete Script

``` sql
-- Drop temp table if exists
DROP TEMPORARY TABLE IF EXISTS tmp_document_ids;

-- Create temp table
CREATE TEMPORARY TABLE tmp_document_ids (
    document_id VARCHAR(64) NOT NULL,
    PRIMARY KEY (document_id)
) ENGINE=MEMORY;

-- Insert 500 document IDs
INSERT INTO tmp_document_ids (document_id) VALUES
('DOC-2026-000001'),
('DOC-2026-000002'),
('DOC-2026-000003'),
('DOC-2026-000004'),
('DOC-2026-000005'),
('DOC-2026-000006'),
('DOC-2026-000007'),
('DOC-2026-000008'),
('DOC-2026-000009'),
('DOC-2026-000010'),
('DOC-2026-000011'),
('DOC-2026-000012'),
('DOC-2026-000013'),
('DOC-2026-000014'),
('DOC-2026-000015'),
('DOC-2026-000016'),
('DOC-2026-000017'),
('DOC-2026-000018'),
('DOC-2026-000019'),
('DOC-2026-000020'),
('DOC-2026-000021'),
('DOC-2026-000022'),
('DOC-2026-000023'),
('DOC-2026-000024'),
('DOC-2026-000025'),
('DOC-2026-000026'),
('DOC-2026-000027'),
('DOC-2026-000028'),
('DOC-2026-000029'),
('DOC-2026-000030'),
('DOC-2026-000031'),
('DOC-2026-000032'),
('DOC-2026-000033'),
('DOC-2026-000034'),
('DOC-2026-000035'),
('DOC-2026-000036'),
('DOC-2026-000037'),
('DOC-2026-000038'),
('DOC-2026-000039'),
('DOC-2026-000040'),
('DOC-2026-000041'),
('DOC-2026-000042'),
('DOC-2026-000043'),
('DOC-2026-000044'),
('DOC-2026-000045'),
('DOC-2026-000046'),
('DOC-2026-000047'),
('DOC-2026-000048'),
('DOC-2026-000049'),
('DOC-2026-000050'),
('DOC-2026-000051'),
('DOC-2026-000052'),
('DOC-2026-000053'),
('DOC-2026-000054'),
('DOC-2026-000055'),
('DOC-2026-000056'),
('DOC-2026-000057'),
('DOC-2026-000058'),
('DOC-2026-000059'),
('DOC-2026-000060'),
('DOC-2026-000061'),
('DOC-2026-000062'),
('DOC-2026-000063'),
('DOC-2026-000064'),
('DOC-2026-000065'),
('DOC-2026-000066'),
('DOC-2026-000067'),
('DOC-2026-000068'),
('DOC-2026-000069'),
('DOC-2026-000070'),
('DOC-2026-000071'),
('DOC-2026-000072'),
('DOC-2026-000073'),
('DOC-2026-000074'),
('DOC-2026-000075'),
('DOC-2026-000076'),
('DOC-2026-000077'),
('DOC-2026-000078'),
('DOC-2026-000079'),
('DOC-2026-000080'),
('DOC-2026-000081'),
('DOC-2026-000082'),
('DOC-2026-000083'),
('DOC-2026-000084'),
('DOC-2026-000085'),
('DOC-2026-000086'),
('DOC-2026-000087'),
('DOC-2026-000088'),
('DOC-2026-000089'),
('DOC-2026-000090'),
('DOC-2026-000091'),
('DOC-2026-000092'),
('DOC-2026-000093'),
('DOC-2026-000094'),
('DOC-2026-000095'),
('DOC-2026-000096'),
('DOC-2026-000097'),
('DOC-2026-000098'),
('DOC-2026-000099'),
('DOC-2026-000100'),
('DOC-2026-000101'),
('DOC-2026-000102'),
('DOC-2026-000103'),
('DOC-2026-000104'),
('DOC-2026-000105'),
('DOC-2026-000106'),
('DOC-2026-000107'),
('DOC-2026-000108'),
('DOC-2026-000109'),
('DOC-2026-000110'),
('DOC-2026-000111'),
('DOC-2026-000112'),
('DOC-2026-000113'),
('DOC-2026-000114'),
('DOC-2026-000115'),
('DOC-2026-000116'),
('DOC-2026-000117'),
('DOC-2026-000118'),
('DOC-2026-000119'),
('DOC-2026-000120'),
('DOC-2026-000121'),
('DOC-2026-000122'),
('DOC-2026-000123'),
('DOC-2026-000124'),
('DOC-2026-000125'),
('DOC-2026-000126'),
('DOC-2026-000127'),
('DOC-2026-000128'),
('DOC-2026-000129'),
('DOC-2026-000130'),
('DOC-2026-000131'),
('DOC-2026-000132'),
('DOC-2026-000133'),
('DOC-2026-000134'),
('DOC-2026-000135'),
('DOC-2026-000136'),
('DOC-2026-000137'),
('DOC-2026-000138'),
('DOC-2026-000139'),
('DOC-2026-000140'),
('DOC-2026-000141'),
('DOC-2026-000142'),
('DOC-2026-000143'),
('DOC-2026-000144'),
('DOC-2026-000145'),
('DOC-2026-000146'),
('DOC-2026-000147'),
('DOC-2026-000148'),
('DOC-2026-000149'),
('DOC-2026-000150'),
('DOC-2026-000151'),
('DOC-2026-000152'),
('DOC-2026-000153'),
('DOC-2026-000154'),
('DOC-2026-000155'),
('DOC-2026-000156'),
('DOC-2026-000157'),
('DOC-2026-000158'),
('DOC-2026-000159'),
('DOC-2026-000160'),
('DOC-2026-000161'),
('DOC-2026-000162'),
('DOC-2026-000163'),
('DOC-2026-000164'),
('DOC-2026-000165'),
('DOC-2026-000166'),
('DOC-2026-000167'),
('DOC-2026-000168'),
('DOC-2026-000169'),
('DOC-2026-000170'),
('DOC-2026-000171'),
('DOC-2026-000172'),
('DOC-2026-000173'),
('DOC-2026-000174'),
('DOC-2026-000175'),
('DOC-2026-000176'),
('DOC-2026-000177'),
('DOC-2026-000178'),
('DOC-2026-000179'),
('DOC-2026-000180'),
('DOC-2026-000181'),
('DOC-2026-000182'),
('DOC-2026-000183'),
('DOC-2026-000184'),
('DOC-2026-000185'),
('DOC-2026-000186'),
('DOC-2026-000187'),
('DOC-2026-000188'),
('DOC-2026-000189'),
('DOC-2026-000190'),
('DOC-2026-000191'),
('DOC-2026-000192'),
('DOC-2026-000193'),
('DOC-2026-000194'),
('DOC-2026-000195'),
('DOC-2026-000196'),
('DOC-2026-000197'),
('DOC-2026-000198'),
('DOC-2026-000199'),
('DOC-2026-000200'),
('DOC-2026-000201'),
('DOC-2026-000202'),
('DOC-2026-000203'),
('DOC-2026-000204'),
('DOC-2026-000205'),
('DOC-2026-000206'),
('DOC-2026-000207'),
('DOC-2026-000208'),
('DOC-2026-000209'),
('DOC-2026-000210'),
('DOC-2026-000211'),
('DOC-2026-000212'),
('DOC-2026-000213'),
('DOC-2026-000214'),
('DOC-2026-000215'),
('DOC-2026-000216'),
('DOC-2026-000217'),
('DOC-2026-000218'),
('DOC-2026-000219'),
('DOC-2026-000220'),
('DOC-2026-000221'),
('DOC-2026-000222'),
('DOC-2026-000223'),
('DOC-2026-000224'),
('DOC-2026-000225'),
('DOC-2026-000226'),
('DOC-2026-000227'),
('DOC-2026-000228'),
('DOC-2026-000229'),
('DOC-2026-000230'),
('DOC-2026-000231'),
('DOC-2026-000232'),
('DOC-2026-000233'),
('DOC-2026-000234'),
('DOC-2026-000235'),
('DOC-2026-000236'),
('DOC-2026-000237'),
('DOC-2026-000238'),
('DOC-2026-000239'),
('DOC-2026-000240'),
('DOC-2026-000241'),
('DOC-2026-000242'),
('DOC-2026-000243'),
('DOC-2026-000244'),
('DOC-2026-000245'),
('DOC-2026-000246'),
('DOC-2026-000247'),
('DOC-2026-000248'),
('DOC-2026-000249'),
('DOC-2026-000250'),
('DOC-2026-000251'),
('DOC-2026-000252'),
('DOC-2026-000253'),
('DOC-2026-000254'),
('DOC-2026-000255'),
('DOC-2026-000256'),
('DOC-2026-000257'),
('DOC-2026-000258'),
('DOC-2026-000259'),
('DOC-2026-000260'),
('DOC-2026-000261'),
('DOC-2026-000262'),
('DOC-2026-000263'),
('DOC-2026-000264'),
('DOC-2026-000265'),
('DOC-2026-000266'),
('DOC-2026-000267'),
('DOC-2026-000268'),
('DOC-2026-000269'),
('DOC-2026-000270'),
('DOC-2026-000271'),
('DOC-2026-000272'),
('DOC-2026-000273'),
('DOC-2026-000274'),
('DOC-2026-000275'),
('DOC-2026-000276'),
('DOC-2026-000277'),
('DOC-2026-000278'),
('DOC-2026-000279'),
('DOC-2026-000280'),
('DOC-2026-000281'),
('DOC-2026-000282'),
('DOC-2026-000283'),
('DOC-2026-000284'),
('DOC-2026-000285'),
('DOC-2026-000286'),
('DOC-2026-000287'),
('DOC-2026-000288'),
('DOC-2026-000289'),
('DOC-2026-000290'),
('DOC-2026-000291'),
('DOC-2026-000292'),
('DOC-2026-000293'),
('DOC-2026-000294'),
('DOC-2026-000295'),
('DOC-2026-000296'),
('DOC-2026-000297'),
('DOC-2026-000298'),
('DOC-2026-000299'),
('DOC-2026-000300'),
('DOC-2026-000301'),
('DOC-2026-000302'),
('DOC-2026-000303'),
('DOC-2026-000304'),
('DOC-2026-000305'),
('DOC-2026-000306'),
('DOC-2026-000307'),
('DOC-2026-000308'),
('DOC-2026-000309'),
('DOC-2026-000310'),
('DOC-2026-000311'),
('DOC-2026-000312'),
('DOC-2026-000313'),
('DOC-2026-000314'),
('DOC-2026-000315'),
('DOC-2026-000316'),
('DOC-2026-000317'),
('DOC-2026-000318'),
('DOC-2026-000319'),
('DOC-2026-000320'),
('DOC-2026-000321'),
('DOC-2026-000322'),
('DOC-2026-000323'),
('DOC-2026-000324'),
('DOC-2026-000325'),
('DOC-2026-000326'),
('DOC-2026-000327'),
('DOC-2026-000328'),
('DOC-2026-000329'),
('DOC-2026-000330'),
('DOC-2026-000331'),
('DOC-2026-000332'),
('DOC-2026-000333'),
('DOC-2026-000334'),
('DOC-2026-000335'),
('DOC-2026-000336'),
('DOC-2026-000337'),
('DOC-2026-000338'),
('DOC-2026-000339'),
('DOC-2026-000340'),
('DOC-2026-000341'),
('DOC-2026-000342'),
('DOC-2026-000343'),
('DOC-2026-000344'),
('DOC-2026-000345'),
('DOC-2026-000346'),
('DOC-2026-000347'),
('DOC-2026-000348'),
('DOC-2026-000349'),
('DOC-2026-000350'),
('DOC-2026-000351'),
('DOC-2026-000352'),
('DOC-2026-000353'),
('DOC-2026-000354'),
('DOC-2026-000355'),
('DOC-2026-000356'),
('DOC-2026-000357'),
('DOC-2026-000358'),
('DOC-2026-000359'),
('DOC-2026-000360'),
('DOC-2026-000361'),
('DOC-2026-000362'),
('DOC-2026-000363'),
('DOC-2026-000364'),
('DOC-2026-000365'),
('DOC-2026-000366'),
('DOC-2026-000367'),
('DOC-2026-000368'),
('DOC-2026-000369'),
('DOC-2026-000370'),
('DOC-2026-000371'),
('DOC-2026-000372'),
('DOC-2026-000373'),
('DOC-2026-000374'),
('DOC-2026-000375'),
('DOC-2026-000376'),
('DOC-2026-000377'),
('DOC-2026-000378'),
('DOC-2026-000379'),
('DOC-2026-000380'),
('DOC-2026-000381'),
('DOC-2026-000382'),
('DOC-2026-000383'),
('DOC-2026-000384'),
('DOC-2026-000385'),
('DOC-2026-000386'),
('DOC-2026-000387'),
('DOC-2026-000388'),
('DOC-2026-000389'),
('DOC-2026-000390'),
('DOC-2026-000391'),
('DOC-2026-000392'),
('DOC-2026-000393'),
('DOC-2026-000394'),
('DOC-2026-000395'),
('DOC-2026-000396'),
('DOC-2026-000397'),
('DOC-2026-000398'),
('DOC-2026-000399'),
('DOC-2026-000400'),
('DOC-2026-000401'),
('DOC-2026-000402'),
('DOC-2026-000403'),
('DOC-2026-000404'),
('DOC-2026-000405'),
('DOC-2026-000406'),
('DOC-2026-000407'),
('DOC-2026-000408'),
('DOC-2026-000409'),
('DOC-2026-000410'),
('DOC-2026-000411'),
('DOC-2026-000412'),
('DOC-2026-000413'),
('DOC-2026-000414'),
('DOC-2026-000415'),
('DOC-2026-000416'),
('DOC-2026-000417'),
('DOC-2026-000418'),
('DOC-2026-000419'),
('DOC-2026-000420'),
('DOC-2026-000421'),
('DOC-2026-000422'),
('DOC-2026-000423'),
('DOC-2026-000424'),
('DOC-2026-000425'),
('DOC-2026-000426'),
('DOC-2026-000427'),
('DOC-2026-000428'),
('DOC-2026-000429'),
('DOC-2026-000430'),
('DOC-2026-000431'),
('DOC-2026-000432'),
('DOC-2026-000433'),
('DOC-2026-000434'),
('DOC-2026-000435'),
('DOC-2026-000436'),
('DOC-2026-000437'),
('DOC-2026-000438'),
('DOC-2026-000439'),
('DOC-2026-000440'),
('DOC-2026-000441'),
('DOC-2026-000442'),
('DOC-2026-000443'),
('DOC-2026-000444'),
('DOC-2026-000445'),
('DOC-2026-000446'),
('DOC-2026-000447'),
('DOC-2026-000448'),
('DOC-2026-000449'),
('DOC-2026-000450'),
('DOC-2026-000451'),
('DOC-2026-000452'),
('DOC-2026-000453'),
('DOC-2026-000454'),
('DOC-2026-000455'),
('DOC-2026-000456'),
('DOC-2026-000457'),
('DOC-2026-000458'),
('DOC-2026-000459'),
('DOC-2026-000460'),
('DOC-2026-000461'),
('DOC-2026-000462'),
('DOC-2026-000463'),
('DOC-2026-000464'),
('DOC-2026-000465'),
('DOC-2026-000466'),
('DOC-2026-000467'),
('DOC-2026-000468'),
('DOC-2026-000469'),
('DOC-2026-000470'),
('DOC-2026-000471'),
('DOC-2026-000472'),
('DOC-2026-000473'),
('DOC-2026-000474'),
('DOC-2026-000475'),
('DOC-2026-000476'),
('DOC-2026-000477'),
('DOC-2026-000478'),
('DOC-2026-000479'),
('DOC-2026-000480'),
('DOC-2026-000481'),
('DOC-2026-000482'),
('DOC-2026-000483'),
('DOC-2026-000484'),
('DOC-2026-000485'),
('DOC-2026-000486'),
('DOC-2026-000487'),
('DOC-2026-000488'),
('DOC-2026-000489'),
('DOC-2026-000490'),
('DOC-2026-000491'),
('DOC-2026-000492'),
('DOC-2026-000493'),
('DOC-2026-000494'),
('DOC-2026-000495'),
('DOC-2026-000496'),
('DOC-2026-000497'),
('DOC-2026-000498'),
('DOC-2026-000499'),
('DOC-2026-000500');

-- Retrieve latest quote per document_id
WITH ranked AS (
    SELECT
        q.*,
        ROW_NUMBER() OVER (
            PARTITION BY q.document_id
            ORDER BY q.created_at DESC, q.id DESC
        ) AS rn
    FROM quotes q
    INNER JOIN tmp_document_ids t
        ON t.document_id = q.document_id
)
SELECT
    ranked.id,
    ranked.document_id,
    ranked.created_at
FROM ranked
WHERE ranked.rn = 1
ORDER BY ranked.document_id;

-- Cleanup
DROP TEMPORARY TABLE IF EXISTS tmp_document_ids;
```

------------------------------------------------------------------------

## Notes

-   Requires MySQL 8+ (window functions).
-   Avoid `SELECT *` in large production tables.
-   Temporary table approach is preferred over large `IN (...)` lists.
-   Tie-breaking is handled using `id DESC` when timestamps are equal.
